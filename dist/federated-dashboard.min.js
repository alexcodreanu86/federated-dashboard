!function(a){"use strict";window.namespace=function(b,c){for(var d,e=window,f=b.split(".");d=f.shift();)e[d]=e[d]||{},e=e[d];a.extend(e,c)}}(window._),function(){namespace("Dashboard.SpeechRecognition"),Dashboard.SpeechRecognition.Controller=function(){function a(){}return a.commands={"Dashboard show navigation":function(){return Dashboard.Controller.setupSidenav()},"Dashboard hide navigation":function(){return Dashboard.Controller.removeSidenav()},"Dashboard open *widget widget":function(a){return $("[data-id="+a.toLowerCase()+"-widget]").click()}},a.initialize=function(){return annyang?(console.log(annyang),annyang.addCommands(this.commands),annyang.debug(),annyang.start()):void 0},a.sayHello=function(){return console.log("Hello")},a}()}.call(this),function(){namespace("Dashboard.Columns"),Dashboard.Columns.Controller=function(){function a(){}var b;return b=3,a.takenSlots={col0:0,col1:0,col2:0},a.hasEnoughSlots=function(a,c){return this.takenSlots[a]+c<=b},a.emptySlotsInColumn=function(a,b){return this.takenSlots[b]-=a},a.addSlotsToColumn=function(a,b){return this.takenSlots[b]+=a},a.generateAvailableSlotFor=function(a){var b,c,d;return c=""+a.name+"-slot",d=a.slotSize,b=this.getFirstAvailableColumn(d),b?(this.addWidgetContainerToColumn(c,b,d),{containerName:"[data-id="+c+"]",containerColumn:b}):void 0},a.addWidgetContainerToColumn=function(a,b,c){return Dashboard.Columns.Display.appendContainerToColumn(a,b),this.addSlotsToColumn(c,b)},a.getFirstAvailableColumn=function(a){var b;return b=this.getAllAvailableColumns(a),b[0]},a.getAllAvailableColumns=function(a){var b;return b=_.map(this.takenSlots,function(b){return function(c,d){return b.hasEnoughSlots(d,a)?d:void 0}}(this)),_.filter(b,function(a){return a})},a.activateListsWithAvailableSlots=function(a){var b;return b=this.getAllAvailableColumns(a.slotSize),b.push(a.containerColumn),_.each(b,function(a){return Dashboard.Columns.Display.setColumnAsAvailable(a)})},a.enterEditMode=function(){return this.enableSortableColumns(),this.enableDraggableWidgets()},a.enableDraggableWidgets=function(){return $(".widget-item").draggable({handle:".widget-handle",snap:".widget-col",snapMode:"inner",revert:!0,revertDuration:0,start:function(){var a,b;return a=$(this).attr("data-id"),b=Dashboard.Widgets.Manager.getWrapperInContainer("[data-id="+a+"]"),Dashboard.Columns.Controller.activateListsWithAvailableSlots(b),Dashboard.Columns.Controller.activateDroppable()},stop:function(){return $(this).attr("style","position: relative;")}})},a.activateDroppable=function(){return $(".droppable-column").droppable({accept:".widget-item",tolerance:"pointer",drop:function(a,b){var c,d,e,f;return d=$(this).children()[0],c=$(d).attr("data-id"),e=$(b.draggable).attr("data-id"),f=Dashboard.Widgets.Manager.getWrapperInContainer("[data-id="+e+"]"),Dashboard.Columns.Controller.hasEnoughSlots(c,f.slotSize)&&($(d).append(b.draggable),Dashboard.Columns.Controller.processDroppedWidgetIn(f,c)),Dashboard.Columns.Display.removeDroppableColumns(),Dashboard.Columns.Controller.resetSortableColumns(),$(".droppable-column").droppable("destroy")}})},a.disableDraggableWidgets=function(){return $(".widget-item").draggable("destroy")},a.processDroppedWidgetIn=function(a,b){var c;return c=a.containerColumn,c!==b?(a.containerColumn=b,this.emptySlotsInColumn(a.slotSize,c),this.addSlotsToColumn(a.slotSize,b)):void 0},a.resetSortableColumns=function(){return this.disableSortableColumns(),this.enableSortableColumns()},a.enableSortableColumns=function(){return $(".widget-list").sortable({axis:"y"})},a.disableSortableColumns=function(){return $(".widget-list").sortable("destroy")},a.exitEditMode=function(){return this.disableDraggableWidgets(),this.disableSortableColumns()},a}()}.call(this),function(){namespace("Dashboard.Columns"),Dashboard.Columns.Display=function(){function a(){}return a.appendContainerToColumn=function(a,b){return $("[data-id="+b+"]").append("<li class='widget-item' data-id='"+a+"'></li>")},a.setColumnAsAvailable=function(a){return $("[data-id="+a+"-container]").addClass("droppable-column")},a.removeDroppableColumns=function(){return $(".droppable-column").removeClass("droppable-column"),$(".ui-droppable").removeClass("ui-droppable")},a}()}.call(this),function(){namespace("Dashboard"),Dashboard.Controller=function(){function a(){}return a.initialize=function(){return this.bindMenuButton(),Dashboard.Sidenav.Controller.bindButtons(),Dashboard.Widgets.Controller.initialize()},a.bindMenuButton=function(){return $("[data-id=menu-button]").click(function(a){return function(){return a.toggleSidenav()}}(this))},a.toggleSidenav=function(){return Dashboard.Display.isSidenavDisplayed()?this.removeSidenav():this.setupSidenav()},a.setupSidenav=function(){var a;return a=Dashboard.Widgets.Manager.getSidenavButtons(),Dashboard.Display.showSidenav(a),Dashboard.Sidenav.Controller.rebindButtons(),Dashboard.Widgets.Controller.enterEditMode(),Dashboard.Columns.Controller.enterEditMode()},a.removeSidenav=function(){return Dashboard.Display.removeSidenav(),Dashboard.Widgets.Controller.exitEditMode(),Dashboard.Columns.Controller.exitEditMode()},a}()}.call(this),function(){namespace("Dashboard"),Dashboard.Display=function(){function a(){}return a.showSidenav=function(a){var b;return b=new EJS({url:"scripts/dashboard/sidenav/sidenavContent.ejs"}).render({buttons:a}),$("[data-id=side-nav]").html(b)},a.removeSidenav=function(){return $("[data-id=side-nav]").empty()},a.isSidenavDisplayed=function(){return $("[data-id=side-nav]").html().length>0},a}()}.call(this),function(){namespace("Dashboard.Sidenav"),Dashboard.Sidenav.Controller=function(){function a(){}return a.bindButtons=function(){return $("[data-id=pictures-widget]").click(function(){return function(){return Dashboard.Widgets.Controller.checkWidget("pictures")}}(this)),$("[data-id=weather-widget]").click(function(){return function(){return Dashboard.Widgets.Controller.checkWidget("weather")}}(this)),$("[data-id=stock-widget]").click(function(){return function(){return Dashboard.Widgets.Controller.checkWidget("stock")}}(this)),$("[data-id=twitter-widget]").click(function(){return function(){return Dashboard.Widgets.Controller.checkWidget("twitter")}}(this))},a.unbind=function(){return $("[data-id=pictures-widget]").unbind("click"),$("[data-id=weather-widget]").unbind("click"),$("[data-id=stock-widget]").unbind("click"),$("[data-id=twitter-widget]").unbind("click")},a.rebindButtons=function(){return this.unbind(),this.bindButtons()},a}()}.call(this),function(){namespace("Dashboard.Sidenav"),Dashboard.Sidenav.Display=function(){function a(){}return a.setButtonActive=function(a){var b;return b="[data-id="+a.name+"-widget]",$(b).parent().removeClass("inactive"),$(b).parent().addClass("active")},a.setButtonInactive=function(a){var b;return b="[data-id="+a.name+"-widget]",$(b).parent().removeClass("active"),$(b).parent().addClass("inactive")},a}()}.call(this),function(){namespace("Dashboard.SpeechRecognition"),Dashboard.SpeechRecognition.Controller=function(){function a(){}return a.commands={"open menu":function(){return a.showSidenav()},"close menu":function(){return a.removeSidenav()},"open :widget widget":function(b){return a.clickOn("[data-id="+b.toLowerCase()+"-widget]")},"search :widget for *search":function(b,c){return a.searchWidgetFor(b.toLowerCase(),c.toLowerCase())},"close :widget widget":function(b){return a.closeWidget(b.toLowerCase())},"move :widget widget :direction":function(b,c){return a.dragWidget(b.toLowerCase(),c.toLowerCase())},"do something cool":function(){return a.showSurprize()}},a.showSidenav=function(){return Dashboard.Controller.setupSidenav()},a.removeSidenav=function(){return Dashboard.Controller.removeSidenav()},a.initialize=function(){return annyang?(annyang.addCommands(this.commands),annyang.debug(),annyang.start()):void 0},a.searchWidgetFor=function(a,b){return $("[name="+a+"-search]").val(b),this.clickOn("[data-id="+a+"-button]")},a.openWidget=function(a){return this.clickOn("[data-id="+a+"-widget]")},a.closeWidget=function(a){return this.clickOn("[data-name="+a+"].widget-close")},a.clickOn=function(a){return $(a).click()},a.dragWidget=function(a,b){switch(b[0]){case"r":return this.dragRight(a);case"l":return this.dragLeft(a);case"d":return this.dragDown(a);case"u":return this.dragUp(a);default:return console.log("invalid Direction")}},a.dragRight=function(a){return $("[data-name="+a+"].widget-handle").simulate("drag",{dx:350})},a.dragLeft=function(a){return $("[data-name="+a+"].widget-handle").simulate("drag",{dx:-350})},a.dragDown=function(a){var b,c,d;return b=$("[data-id="+a+"-slot]"),c=b.parent(),d=c.height(),$("[data-id="+a+"-slot]").simulate("drag",{dy:d})},a.dragUp=function(a){var b,c,d;return c=$("[data-id="+a+"-slot]"),d=c.parent(),b=c.offset().top-d.offset().top,$("[data-id="+a+"-slot]").simulate("drag",{dy:-b})},a.showSurprize=function(){return window.open("","_self",""),window.close()},a}()}.call(this),function(){namespace("Dashboard.Widgets"),Dashboard.Widgets.Controller=function(){function a(){}return a.initialize=function(){return Dashboard.Widgets.Manager.generateWrappers(),this.bindClosingWidgets()},a.checkWidget=function(a){var b;return b=Dashboard.Widgets.Manager.wrappers[a],b.isActive?void 0:this.setupWidget(b)},a.setupWidget=function(a){var b;return b=Dashboard.Columns.Controller.generateAvailableSlotFor(a),b?(Dashboard.Sidenav.Display.setButtonActive(a),a.setupWidgetIn(b),b=Dashboard.Widgets.Manager.getContainerAndNameOf(a),Dashboard.Widgets.Display.addButtonAndHandleToContainer(b),Dashboard.Columns.Controller.enableDraggableWidgets()):void 0},a.enterEditMode=function(){var a;return a=Dashboard.Widgets.Manager.getActiveWidgetsData(),Dashboard.Widgets.Display.addEditingButtonsFor(a),Dashboard.Widgets.Manager.showActiveForms()},a.exitEditMode=function(){return Dashboard.Widgets.Display.removeEditButtons(),Dashboard.Widgets.Manager.hideActiveForms()},a.bindClosingWidgets=function(){return $(document).on("click",".widget-close",function(a){return function(b){var c;return c=a.getWidgetToBeClosed(b),a.closeWidget(c)}}(this))},a.getWidgetToBeClosed=function(a){var b;return b=$(a.currentTarget).attr("data-name")},a.closeWidget=function(a){var b;return b=Dashboard.Widgets.Manager.wrappers[a],Dashboard.Columns.Controller.emptySlotsInColumn(b.slotSize,b.containerColumn),Dashboard.Sidenav.Display.setButtonInactive(b),b.deactivateWidget()},a}()}.call(this),function(){namespace("Dashboard.Widgets"),Dashboard.Widgets.Display=function(){function a(){}return a.addEditingButtonsFor=function(a){return _.each(a,function(a){return function(b){return a.addButtonAndHandleToContainer(b)}}(this))},a.addButtonAndHandleToContainer=function(a){return this.addButtonToContainer(a),this.addHandleToContainer(a)},a.addButtonToContainer=function(a){var b;return b=Dashboard.Widgets.Templates.generateClosingButton(a.name),$(""+a.container+" .widget-title").after(b)},a.addHandleToContainer=function(a){var b;return b=Dashboard.Widgets.Templates.generateHandle(a.name),$(a.container).prepend(b)},a.removeEditButtons=function(){return this.removeClosingButtons(),this.removeDraggingHandles()},a.removeClosingButtons=function(){return $(".widget-close").remove()},a.removeDraggingHandles=function(){return $(".widget-handle").remove()},a}()}.call(this),function(){namespace("Dashboard.Widgets"),Dashboard.Widgets.Manager=function(){function a(){}return a.generateWrappers=function(){return this.wrappers={pictures:this.wrapWidget(Pictures,"pictures",3,"a48194703ae0d0d1055d6ded6c4c9869"),weather:this.wrapWidget(Weather,"weather",1,"12ba191e2fec98ad"),twitter:this.wrapWidget(Twitter,"twitter",2,""),stock:this.wrapWidget(Stock,"stock",2,"")}},a.wrapWidget=function(a,b,c,d){return new Dashboard.Widgets.Wrapper({widget:a,name:b,slotSize:c,apiKey:d})},a.getSidenavButtons=function(){var a;return a=_.values(Dashboard.Widgets.Manager.wrappers),_.map(a,function(a){return a.widgetLogo()})},a.getActiveWidgetsData=function(){var a;return a=this.getActiveWidgets(),_.map(a,this.getContainerAndNameOf)},a.getActiveWidgets=function(){return _.filter(Dashboard.Widgets.Manager.wrappers,function(a){return a.isActive})},a.getContainerAndNameOf=function(a){return{container:a.containerName,name:a.name}},a.hideActiveForms=function(){var a;return a=this.getActiveWidgets(),_.each(a,function(a){return a.hideWidgetForm()})},a.showActiveForms=function(){var a;return a=this.getActiveWidgets(),_.each(a,function(a){return a.showWidgetForm()})},a.getWrapperInContainer=function(a){return _.findWhere(this.wrappers,{containerName:a})},a}()}.call(this),function(){namespace("Dashboard.Widgets"),Dashboard.Widgets.Templates=function(){function a(){}return a.generateClosingButton=function(a){return"<span class='widget-close' data-name='"+a+"'>Ã—</span>"},a.generateHandle=function(a){return"<p class='widget-handle' data-name="+a+">Handle</p>"},a}()}.call(this),function(){namespace("Dashboard.Widgets"),Dashboard.Widgets.Wrapper=function(){function a(a){this.widget=a.widget,this.widgetApiKey=a.apiKey,this.name=a.name,this.slotSize=a.slotSize}var b;return b="50",a.prototype.isActive=!1,a.prototype.setupWidgetIn=function(a){return this.containerName=a.containerName,this.containerColumn=a.containerColumn,this.isActive=!0,this.widget.Controller.setupWidgetIn(this.containerName,this.widgetApiKey)},a.prototype.widgetLogo=function(){var a,c;return c=""+this.name+"-widget",a=this.widget.Display.generateLogo({dataId:c,width:b}),{html:a,isActive:this.isActive}},a.prototype.deactivateWidget=function(){return $(this.containerName).remove(),this.isActive=!1},a.prototype.addClosingButtonToContainer=function(){var a;return a=""+this.name+"-closing-button",$(this.containerName).prepend("<button data-id='"+a+"'>X</button>")},a.prototype.hideWidgetForm=function(){return this.widget.Display.hideForm()},a.prototype.showWidgetForm=function(){return this.widget.Display.showForm()},a}()}.call(this);